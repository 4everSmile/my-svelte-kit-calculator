// packages/worktop/src/deno.ws.ts
import { connect as d } from "worktop/ws";
function u(s) {
  return function(t, a) {
    let n = d(t);
    if (n)
      return n;
    let c = {}, { websocket: e, response: l } = Deno.upgradeWebSocket(t);
    function r(o) {
      return s(t, a, {
        send: e.send.bind(e),
        close: e.close.bind(e),
        state: c,
        event: o
      });
    }
    async function p(o) {
      try {
        await r(o);
      } finally {
        e.close();
      }
    }
    return e.onopen = e.onmessage = r, e.onclose = e.onerror = p, l;
  };
}
export {
  u as listen
};
