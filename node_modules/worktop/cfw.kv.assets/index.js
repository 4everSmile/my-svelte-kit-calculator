// packages/worktop/src/cfw.kv.assets.ts
const { lookup:d, mimes:w } = require('mrmime');
async function x(m, t) {
  let a = typeof t == "string", u = !a && t.method === "HEAD";
  if (!(a || u || t.method === "GET"))
    return;
  let s = a ? t : new URL(t.url).pathname;
  !a && s.endsWith("/") && (s += "index.html");
  let r = await m.get(s, "arrayBuffer");
  if (r == null)
    return new Response(null, { status: 404 });
  let g = s.lastIndexOf("."), i = ~g ? s.substring(++g) : s, p = !a && t.headers.get("range"), f = p ? 206 : 200, n = r.byteLength, e = {
    "content-length": String(n)
  };
  if (i = i && d(i), i && (e["content-type"] = i), p) {
    let [c, h] = p.replace("bytes=", "").split("-"), l = parseInt(h, 10) || n - 1, o = parseInt(c, 10) || 0;
    if (o >= n || l >= n)
      return e["content-range"] = `bytes */${n}`, new Response(null, { status: 416, headers: e });
    e["content-range"] = `bytes ${o}-${l}/${n}`, e["content-length"] = String(l - o + 1), e["accept-ranges"] = "bytes", r = r.slice(o, l);
  }
  return new Response(u ? null : r, { status: f, headers: e });
}


exports.mimes = w;
exports.serve = x;