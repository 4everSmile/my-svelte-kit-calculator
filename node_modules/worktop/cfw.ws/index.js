// packages/worktop/src/cfw.ws.ts
const { connect:d } = require('worktop/ws');
function u(a) {
  return function(n, c) {
    let r = d(n);
    if (r)
      return r;
    let { 0: i, 1: e } = new WebSocketPair(), l = {};
    function o(t) {
      return a(n, c, {
        send: e.send.bind(e),
        close: e.close.bind(e),
        state: l,
        event: t
      });
    }
    async function s(t) {
      try {
        await o(t);
      } finally {
        e.close();
      }
    }
    return e.accept(), e.addEventListener("close", s), e.addEventListener("message", o), e.addEventListener("error", s), new Response(null, {
      status: 101,
      statusText: "Switching Protocols",
      webSocket: i
    });
  };
}


exports.listen = u;